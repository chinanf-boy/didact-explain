
## 2. å…ƒç´ åˆ›å»ºå’ŒJSX

> è¿™ä¸ªæ•…äº‹æ˜¯æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ„å»ºè‡ªå·±ç‰ˆæœ¬çš„Reactçš„ç³»åˆ—æ–‡ç« çš„ä¸€éƒ¨åˆ†ï¼š

### 2.1 JSX

ä¸Šæ¬¡æˆ‘ä»¬ä»‹ç»äº†[Didact Elements](#1.2-didactå…ƒç´ )ï¼Œå®ƒæ˜¯ä¸€ç§æè¿°æˆ‘ä»¬æƒ³è¦å‘ˆç°ç»™-DOM-çš„éå¸¸è¯¦ç»†çš„æ–¹å¼`{æ•°æ®ç»“æ„}`ã€‚

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•ä½¿ç”¨`JSX`æ¥ç®€åŒ–å…ƒç´ çš„åˆ›å»ºã€‚

`JSX`æä¾›äº†ä¸€äº›è¯­æ³•ç³–æ¥åˆ›å»ºå…ƒç´ ã€‚ä»¥ä¾¿ä»£æ›¿ï¼š

``` js
const element = {
  type: "div",
  props: {
    id: "container",
    children: [
      { type: "input", props: { value: "foo", type: "text" } },
      {
        type: "a",
        props: {
          href: "/bar",
          children: [{ type: "TEXT ELEMENT", props: { nodeValue: "bar" } }]
        }
      },
      {
        type: "span",
        props: {
          onClick: e => alert("Hi"),
          children: [{ type: "TEXT ELEMENT", props: { nodeValue: "click me" } }]
        }
      }
    ]
  }
};
```

æˆ‘ä»¬çš„ä»£ç å¯ä»¥æ˜¯

``` js
const element = (
  <div id="container">
    <input value="foo" type="text" />
    <a href="/bar">bar</a>
    <span onClick={e => alert("Hi")}>click me</span>
  </div>
);
```

å¦‚æœä½ å¯¹`JSX`ä¸ç†Ÿæ‚‰ï¼Œä½ å¯èƒ½ä¼šæƒ³çŸ¥é“æœ€åä¸€ä¸ªç‰‡æ®µæ˜¯å¦æ˜¯æœ‰æ•ˆçš„`javascriptï¼š`å®ƒä¸æ˜¯ã€‚

ä¸ºäº†ä½¿æµè§ˆå™¨çš„ç†è§£ï¼Œéœ€è¦çš„ä»£ç ç”±é¢„å¤„ç†è½¬åŒ–ä¸º-æœ‰æ•ˆçš„JSï¼Œåƒbabel[äº†è§£æ›´å¤šå…³äºJSXé˜…è¯»è¿™ç¯‡æ–‡ç« ç”±è´¾æ£®Â·ç±³å‹’](https://jasonformat.com/wtf-is-jsx/)ã€‚

ä¾‹å¦‚ï¼Œ`babel`ä»ä¸Šé¢å°†JSXè½¬æ¢ä¸ºï¼š

``` js
const element = createElement(
  "div",
  { id: "container" },
  createElement("input", { value: "foo", type: "text" }),
  createElement(
    "a",
    { href: "/bar" },
    "bar"
  ),
  createElement(
    "span",
    { onClick: e => alert("Hi") },
    "click me"
  )
);
```

> [>> babel repl ](https://babeljs.io/repl/#?babili=false&evaluate=true&lineWrap=false&presets=react&targets=&browsers=&builtIns=false&debug=false&code=%2F**%20%40jsx%20createElement%20*%2F%0A%0Aconst%20element%20%3D%20%28%0A%20%20%3Cdiv%20id%3D%22container%22%3E%0A%20%20%20%20%3Cinput%20value%3D%22foo%22%20type%3D%22text%22%20%2F%3E%0A%20%20%20%20%3Ca%20href%3D%22%2Fbar%22%3Ebar%3C%2Fa%3E%0A%20%20%20%20%3Cspan%20onClick%3D%7Be%20%3D%3E%20alert%28%22Hi%22%29%7D%3Eclick%20me%3C%2Fspan%3E%0A%20%20%3C%2Fdiv%3E%0A%29%3B)

æˆ‘ä»¬éœ€è¦æ·»åŠ åˆ°`Didact`ä¸­æ¥æ”¯æŒ`JSX`æ˜¯ä¸€ä¸ª`createElement`åŠŸèƒ½ï¼Œè¿™å°±æ˜¯å…¶ä½™éƒ¨åˆ†å·¥ä½œç”±-é¢„å¤„ç†å™¨-å®Œæˆçš„ã€‚

å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯`type`å…ƒç´ çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å…ƒç´ çš„å¯¹è±¡`props`ï¼Œä»¥åŠæ‰€æœ‰ä¸‹é¢çš„å‚æ•°`children`ã€‚

`createElement`éœ€è¦åˆ›å»ºä¸€ä¸ª`props`å¯¹è±¡ï¼Œå°†å…¶åˆ†é…ç»™ç¬¬äºŒä¸ªå‚æ•°ä¸­çš„æ‰€æœ‰å€¼ï¼Œå°†è¯¥`children`å±æ€§è®¾ç½®ä¸ºç¬¬äºŒä¸ªå‚æ•°åé¢çš„æ‰€æœ‰å‚æ•°ï¼Œç„¶åè¿”å›ä¸€ä¸ªå¯¹è±¡`{}` - å¸¦æœ‰ `{type, props }`ã€‚æŠŠå®ƒæ”¾åˆ°ä»£ç ä¸­æ›´å®¹æ˜“ï¼š

``` js
function createElement(type, config, ...args) {
  const props = Object.assign({}, config);// åˆå¹¶
  const hasChildren = args.length > 0; // å­©å­ï¼Ÿ
  props.children = hasChildren ? [].concat(...args) : [];
  return { type, props }; // Didactå…ƒç´ çš„æ•°æ®ç»“æ„-ç±»å‹{type}ä¸å±æ€§{props}
}
```

é™¤äº†ä¸€ä»¶äº‹æƒ…ä¹‹å¤–ï¼Œè¿™ä¸ªå‡½æ•°è¿è¡Œè‰¯å¥½ï¼š`æ–‡æœ¬å…ƒç´ `ã€‚

æ–‡æœ¬-ä½œä¸ºå­—ç¬¦ä¸²-ä¼ é€’ç»™`createElement`å‡½æ•°ï¼Œ`Didact`éœ€è¦æ–‡æœ¬å…ƒç´ `type`ä»¥åŠ`props`å…¶ä½™å…ƒç´ ã€‚

æ‰€ä»¥æˆ‘ä»¬å°†`æ¯ä¸ªarg`è½¬æ¢ä¸ºä¸€ä¸ªæ–‡æœ¬å…ƒç´ -ä¸€ä¸ªè§„èŒƒçš„`Didactå…ƒç´ ï¼š

``` js
const TEXT_ELEMENT = "TEXT ELEMENT"; // ç±»å‹

function createElement(type, config, ...args) {
  const props = Object.assign({}, config);
  const hasChildren = args.length > 0;
  const rawChildren = hasChildren ? [].concat(...args) : [];
  props.children = rawChildren
    .filter(c => c != null && c !== false)
    .map(c => c instanceof Object ? c : createTextElement(c));
    // è¿‡æ»¤-ç©º-å€¼, å‰©ä¸‹çš„-ä¸å±äº-Objectçš„å€¼ -> createTextElement -> å˜ä¸º ç±»å‹ä¸ºTEXT_ELEMENT- Didactå…ƒç´ 
  return { type, props };
}

function createTextElement(value) {
  // è§„èŒƒæ•°æ®
  return createElement(TEXT_ELEMENT, { nodeValue: value });
}
```

æˆ‘è¿˜ç­›é€‰äº†è¦æ’é™¤çš„å­é¡¹åˆ—è¡¨`nullï¼Œundefinedå¹¶æŒ‡å‡ºfalse`.

æˆ‘ä»¬ä¸ä¼šå‘ˆç°è¿™äº›å­é¡¹ï¼Œå› æ­¤ä¸éœ€è¦`æ·»åŠ `å®ƒä»¬`props.children`ã€‚


### 2.2 æ¦‚è¦

åœ¨è¿™ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬æ²¡æœ‰ç»™`Didact`å¢åŠ ä»»ä½•å®é™…çš„æƒåŠ›ï¼Œä½†æ˜¯æˆ‘ä»¬ç°åœ¨æœ‰äº†æ”¹è¿›çš„å¼€å‘è€…ä½“éªŒï¼Œ

å› ä¸ºæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`JSX`æ¥å®šä¹‰å…ƒç´ ã€‚æˆ‘å·²ç»[æ›´æ–°äº†ä¸Šæ¬¡çš„codepen](https://codepen.io/pomber/pen/xdmoWE?editors=0010)ä»¥åŒ…å«æ¥è‡ªè¿™ç¯‡æ–‡ç« çš„ä»£ç ã€‚

è¯·æ³¨æ„ï¼Œ`codepen`ä½¿ç”¨`babelæ¥ä¼ è¾“JSX`ï¼Œå¼€å¤´çš„æ³¨é‡Š`/** @jsx createElement */`å‘Šè¯‰`babel`ä½¿ç”¨å‡½æ•°ã€‚

æ‚¨è¿˜å¯ä»¥æ£€æŸ¥[Githubæäº¤çš„æ›´æ”¹ã€‚](https://github.com/hexacta/didact/commit/15010f8e7b8b54841d1e2dd9eacf7b3c06b1a24b)

---

åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œ[Didact: Instances, reconciliation and virtual DOM](https://engineering.hexacta.com/didact-instances-reconciliation-and-virtual-dom-9316d650f1d0) |-|_|ğŸŒŸ| [æˆ‘ä»¬ä»‹ç»äº†Didactçš„è™šæ‹ŸDOMå’Œåè°ƒç®—æ³•ä»¥æ”¯æŒDOMæ›´æ–°](#3-%E5%AE%9E%E4%BE%8B-%E5%AF%B9%E6%AF%94%E5%92%8C%E8%99%9A%E6%8B%9Fdom)
